<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- CVS History
	  $Log: report_pmd.xml,v $
	  Revision 1.3  2007/12/18 13:13:27  beal6226
	  Version G3R2C0
	
	  Revision 1.2  2006/11/02 13:54:48  beal6226
	  Synchronisation avec referentiel plateforme Eclipse
	
	  Revision 1.1  2006/10/10 08:10:37  ajta5630
	  Intérgration dans la barre d'outils et le menu du workbench. Intégration de l'aide
	
	  Revision 1.1  2006/03/20 16:31:35  beal6226
	  Initial plugin version
	
	  Revision 1.5  2006/03/15 16:49:55  beal6226
	  La variable TODAY doit être définie dans le projet où elle est utilisée. Le timestamp est donc placé devant chaque utilisation de TODAY.
	  Ajout d'une description aux tâches les plus utiles pour un accès plus facile avec la vue outline d'Eclipse.
	  Ajout de doubles traits dans les messages ant pour bien visualiser la fin de construction de chaque module
	
	  Revision 1.4  2006/03/14 16:57:01  beal6226
	  Nouvelle version de PMD et des règles Clara, directement dans les librairies du toolkit.
	  Attention, sur le palier S2D2, supprimer les anciens fichiers PMD dans Window/Preferences/Ant/Runtime
	
	  Revision 1.2  2005/06/15 11:37:42  beal6226
	  Définition de la tâche PMD dans le setenv plutôt que dans les paramètres de Eclipse
	
	  Revision 1.1  2005/05/26 12:14:34  beal6226
	  Ajout de tâches de reporting : javadoc, tests junit, PMD
	
-->
<!DOCTYPE project [
		<!ENTITY setenv SYSTEM "../conf/setenv.xml">	
	]>
<project name="report_pmd" default="init" basedir="../..">

	<!-- Chargement des propriétés -->
	&setenv;
    <property file="${ant.modules.dir}/${module.type}.${module.name}.properties" />

	<target name="report" depends="init">
		<antcall target="report_file">
			<param name="pmd.file" value="J-CLARA2" />
		</antcall>
		<antcall target="report_file">
			<param name="pmd.file" value="J-CLARA3" />
		</antcall>
		<antcall target="report_file">
			<param name="pmd.file" value="J-CLARA4" />
		</antcall>
		<antcall target="report_file">
			<param name="pmd.file" value="erreur" />
		</antcall>
		<antcall target="report_file">
			<param name="pmd.file" value="pmd" />
		</antcall>
	</target>

	<!-- TARGET internet report_file -->
	<target name="report_file" depends="define_pmd">
		<echo message="Vérification des règles du fichier ${pmd.file}.xml" />
		<!-- Les fichiers se trouvent dans rules.jar, qui est dans le classpath -->
		<pmd rulesetfiles="${pmd.file}.xml"
		     shortFilenames="true"
		     encoding="iso-8859-1">
			<formatter type="xml" toFile="${tmp.dir}/report_pmd_${pmd.file}.xml" />
			<fileset dir="${src.dir}">
				<include name="**/*.java" />
			</fileset>
		</pmd>
		<style in="${tmp.dir}/report_pmd_${pmd.file}.xml"
	       out="${dist.dir}/reports/pmd/report_pmd_${pmd.file}.html"
	       style="${ant.conf.dir}/pmd/rapport.xsl">
		</style>
		<echo message="========== Rapport pmd terminé, consulter ${dist.dir}/reports/pmd ==========" />
	</target>

	<!-- TARGET internet init -->
	<target name="init">
		<!-- Création des répertoires nécessaires au fonctionnement du rapport -->
		<mkdir dir="${tmp.dir}" />
		<mkdir dir="${dist.dir}/reports/pmd" />
	</target>

</project>